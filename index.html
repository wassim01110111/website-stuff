<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Riddle Selection</title>

    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="title-header">
      <button
        onclick="
          window.open(
            'https://discord.com/channels/563405492420870155/1463564235031183528/1463564235031183528',
            '_blank',
          )
        "
      >
        Give feedback üìù
      </button>
      <span>üß© Choose a Puzzle</span>
      <button onclick="resetStats()">Reset stats ‚ö†Ô∏è</button>
    </div>
    <div class="stats"></div>

    <div class="banks" style="height: auto; margin-top: 60px">
      <div class="bank" style="position: relative; margin: 0 auto; width: 90%">
        <h2 class="menuHeader" data-href="raft">Raft Puzzles</h2>
        <h2 class="menuHeader" data-href="clock">Clock Puzzles</h2>
        <h2 class="menuHeader" data-href="potion">Potion Brewing</h2>
        <h2 class="menuHeader" data-href="stack">Stacks</h2>
      </div>
    </div>
    <script src="scripts.js"></script>
    <script>
      document.querySelectorAll(".menuHeader").forEach((header) => {
        const prehref = header.dataset.href + "/";

        Object.keys(xpFiles).forEach((fileName) => {
          if (fileName.startsWith(header.dataset.href)) {
            const button = document.createElement("button");
            header.appendChild(button);
            button.className = "menuButton";
            const href = prehref + fileName;
            const buttonFile = href.split("/").pop();
            if (xpFiles[buttonFile]) {
              button.textContent = xpFiles[buttonFile].title;
              const buttonXP = xpFiles[buttonFile].xpGained;
              console.log(buttonXP, buttonFile);
              if (playerData.completedLevels[buttonFile]) {
                button.classList.add("completed");
              } else if (buttonXP > 0 && buttonXP < 4) {
                button.classList.add("easy");
              } else if (4 <= buttonXP && buttonXP < 6) {
                button.classList.add("medium");
              } else {
                button.classList.add("hard");
              }
            } else {
              button.textContent = "File not found";
            }
            button.addEventListener("click", () => {
              location.href = href;
            });
          }
        });
      });
      function updateStatsUI() {
        const statsDiv = document.querySelector(".stats");
        if (!statsDiv) return;

        const { sequence, time_played, totalXP } = playerData.stats;

        statsDiv.innerHTML = `
        <h3>Beyonder Stats</h3>
        <p>Sequence: <span>${sequence}</span></p>
        <p>Time Played: <span>${formatTime(time_played)}</span></p>
      `;
      }
      window.addEventListener("DOMContentLoaded", updateStatsUI);

      function resetStats() {
        const confirmReset = confirm(
          "Are you sure you want to reset all your progress? This cannot be undone!",
        );
        if (!confirmReset) return;

        const defaultData = {
          completedLevels: {},
          stats: {
            sequence: levels[0].name,
            time_played: 0,
            totalXP: 0,
            level: 0,
          },
        };

        localStorage.setItem("playerData", JSON.stringify(defaultData));
        alert("All stats have been reset!");
        location.reload();
      }
    </script>
  </body>
</html>
