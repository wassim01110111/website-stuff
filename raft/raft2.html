<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Avoid the Ban</title>
    <link rel="stylesheet" href="../styles.css" />
  </head>
  <body>
    <div class="title-header">
      <button onclick="location.href = '../index.html'">
        ‚¨Ö Back to Riddle Selection
      </button>
      <div class="header-title">
        <span id="title_name"></span>
        <span> - Time Elapsed: </span>
        <span id="time_played">0s</span>
      </div>
      <button onclick="location.reload()">üîÑÔ∏è Retry</button>
    </div>
    <div class="rules-container">
      <h2>Rules</h2>
      <ul class="rules">
        <li>
          Move the Nivleks and Nets from <b>Coi-Completed</b> to
          <b>Mod-Support</b> while obeying the following rules:
        </li>
        <li>
          No more than <b>two people</b> can ride the raft at the same time.
        </li>
        <li>
          There must be at least <b>one person</b> on the raft in order for it
          to move.
        </li>
        <li>
          Don't let the <b>Nets outnumber the Nivleks</b> on either side of the
          channels, they will get banned and you'll have to start over.
        </li>
        <li>
          Finish in <span class="maxMove"></span> moves or they will all get
          banned.
        </li>
      </ul>
    </div>

    <div class="status" id="status"></div>
    <p>Moves: <span id="moveCount">0</span> / <span class="maxMove"></span></p>

    <div class="banks">
      <div class="bank left" id="nationEvernight">
        <h2>#coi-completed</h2>
        <div class="images" id="leftImages"></div>
      </div>

      <div class="bank right" id="sefirahCastle">
        <h2>#mod-support</h2>
        <div class="images" id="rightImages"></div>
      </div>

      <div id="raft" class="raft left">
        <h3>Raft</h3>
        <div class="images" id="raftImages"></div>
        <button onclick="moveRaft()">Move Raft</button>
      </div>
    </div>
    <script>
      const maxMove = 11;
    </script>
    <script src="../scripts.js"></script>
    <script src="raft.js"></script>
    <script>
      const items = { Niv: "../images/niv.jpg", Nets: "../images/nets.jpg" };
      let right = [];
      let raft = [];
      let raftSide = "left";
      let left = [
        { id: 1, type: "Niv" },
        { id: 2, type: "Niv" },
        { id: 3, type: "Niv" },
        { id: 4, type: "Nets" },
        { id: 5, type: "Nets" },
        { id: 6, type: "Nets" },
      ];

      function makeItem(character, location) {
        const wrapper = document.createElement("div");
        wrapper.className = "character";
        const img = document.createElement("img");
        img.src = items[character.type];
        img.className = "item";
        img.onclick = () => toggleItem(character.id, location);
        const label = document.createElement("div");
        label.className = "name";
        label.textContent = character.type;
        wrapper.appendChild(img);
        wrapper.appendChild(label);
        return wrapper;
      }

      const leftDiv = document.getElementById("leftImages");
      const rightDiv = document.getElementById("rightImages");
      const raftDiv = document.getElementById("raftImages");
      const raftEl = document.getElementById("raft");

      function toggleItem(id, location) {
        if (gameOver) return;

        let source, dest;
        if (location === "left") source = left;
        else if (location === "right") source = right;
        else source = raft;

        const charIndex = source.findIndex((c) => c.id === id);
        if (charIndex === -1) return;
        const character = source.splice(charIndex, 1)[0];

        if (location === "raft") {
          dest = raftSide === "left" ? left : right;
        } else {
          if (raft.length >= 2) {
            statusDiv.textContent = "üö´ Raft can carry max 2!";
            source.push(character);
            return;
          }
          if (location !== raftSide) {
            source.push(character);
            return;
          }
          dest = raft;
        }

        dest.push(character);
        render();
      }

      function invalidBank(bank) {
        const niv = bank.filter((c) => c.type === "Niv").length;
        const nets = bank.filter((c) => c.type === "Nets").length;
        return nets > niv && niv > 0;
      }

      function moveRaft() {
        if (gameOver) return;
        if (raft.length === 0) {
          statusDiv.textContent =
            "üö£‚Äç‚ôÇÔ∏è You need at least one person on the raft!";
          return;
        }

        moveCount++;
        raftSide = raftSide === "left" ? "right" : "left";
        const target = raftSide === "left" ? left : right;
        raft.forEach((i) => target.push(i));
        raft = [];
        render();

        if (moveCount > maxMove) {
          showDeathMessage("‚è≥ You took too long. Game over.");
          return;
        }

        if (invalidBank(left) || invalidBank(right)) {
          showDeathMessage("üíÄ Nets outnumbered Nivs. Try again!");
          return;
        }

        if (right.length === 6) {
          showwinMessage("üéâ Nekros hasn't banned anyone!");
          gameOver = true;
          return;
        }

        statusDiv.textContent = "";
      }

      window.addEventListener("resize", render);
      render();
    </script>
  </body>
</html>
